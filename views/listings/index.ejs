<% layout("/layouts/boilerplate") %>

<div class="container-fluid py-4">
    <!-- Hero Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="text-center">
                <h1 class="display-4 fw-bold mb-3">Discover Amazing Places</h1>
                <p class="lead text-muted mb-4">Find your perfect getaway from thousands of unique accommodations</p>
                <% if (currUser) { %>
                <a href="/listings/new" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus me-2"></i>Add New Listing
                </a>
                <% } %>
            </div>
        </div>
    </div>
    
    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-lg-4 col-md-6">
                            <input type="text" class="form-control" placeholder="Search by location..." id="searchInput">
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <select class="form-select" id="priceFilter">
                                <option value="">Price Range</option>
                                <option value="0-50">$0 - $50</option>
                                <option value="50-100">$50 - $100</option>
                                <option value="100-200">$100 - $200</option>
                                <option value="200+">$200+</option>
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <select class="form-select" id="countryFilter">
                                <option value="">All Countries</option>
                                <!-- Add country options dynamically -->
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <button class="btn btn-outline-primary w-100" type="button">
                                <i class="fas fa-search me-1"></i>Search
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Listings Grid -->
    <div class="row" id="listingsContainer">
        <% for (let listing of allListings) { %>
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-4 listing-card" 
             data-location="<%= listing.location %>" 
             data-country="<%= listing.country %>" 
             data-price="<%= listing.price %>">
            <div class="card h-100 shadow-sm border-0 listing-hover">
                <!-- Image -->
                <div class="position-relative overflow-hidden">
                    <img src="<%= listing.image.url %>" 
                         class="card-img-top listing-image" 
                         alt="<%= listing.title %>"
                         style="height: 250px; object-fit: cover; transition: transform 0.3s;">
                    
                    <!-- Price badge -->
                    <div class="position-absolute top-0 end-0 m-3">
                        <span class="badge bg-dark bg-opacity-75 rounded-pill px-3 py-2">
                            $<%= listing.price %>/night
                        </span>
                    </div>
                    
                    <!-- Favorite button -->
                    <div class="position-absolute top-0 start-0 m-3">
                        <button class="btn btn-light btn-sm rounded-circle favorite-btn" data-id="<%= listing._id %>">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Card body -->
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-truncate mb-2"><%= listing.title %></h5>
                    <p class="card-text text-muted small mb-2">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        <%= listing.location %>, <%= listing.country %>
                    </p>
                    <p class="card-text flex-grow-1">
                        <%= listing.description.length > 100 ? listing.description.substring(0, 100) + "..." : listing.description %>
                    </p>
                    
                    <!-- Rating -->
                    <div class="d-flex align-items-center mb-3">
                        <div class="text-warning me-2">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <i class="fas fa-star"></i>
                            <% } %>
                        </div>
                        <small class="text-muted">4.8 (12 reviews)</small>
                    </div>
                    
                    <!-- Action button -->
                    <a href="/listings/<%= listing._id %>" class="btn btn-outline-primary mt-auto">
                        <i class="fas fa-eye me-1"></i>View Details
                    </a>
                </div>
            </div>
        </div>
        <% } %>
    </div>
    
    <!-- Empty state -->
    <% if (allListings.length === 0) { %>
    <div class="row">
        <div class="col-12 text-center py-5">
            <i class="fas fa-home fa-4x text-muted mb-3"></i>
            <h3 class="text-muted">No listings found</h3>
            <p class="text-muted">Be the first to add a listing!</p>
            <% if (currUser) { %>
            <a href="/listings/new" class="btn btn-primary">Add New Listing</a>
            <% } %>
        </div>
    </div>
    <% } %>
</div>